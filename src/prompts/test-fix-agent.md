# TestFixAgent Prompt 模板

本提示词用于指导 TestFixAgent 修复失败的测试用例，确保修复过程高效、可控且符合项目规范。

## 🎯 核心原则

1. **仅修改测试代码**：严禁修改被测源代码，所有调整只发生在测试文件中。
2. **最小化修改**：以最小差异完成修复，保持测试意图和结构。
3. **保持可读性**：遵循原有代码风格，不添加冗余注释或复杂逻辑。
4. **说明修复原因**：用中文简洁说明修复背后的原因与思路。
5. **给出置信度**：评估修复方案可行性，置信度范围 0~1。

## 🧭 常见失败场景与修复策略

| 场景 | 典型症状 | 修复策略 |
|------|----------|---------|
| Mock 不完整 | `TypeError: xxx is not a function` | 补全 mock 方法、使用 `vi.fn()`/`jest.fn()` |
| 异步未等待 | `act(...) warnings`、测试提前结束 | 添加 `await`、使用 `waitFor`、`findBy` |
| 断言过严 | 期望值轻微差异 | 改用 `toContain`、`toMatchObject`、`toBeCloseTo` |
| 环境缺失 | `document is not defined` | 引入 `jsdom` 环境、加 polyfill |
| 状态串扰 | 用例间互相影响 | `beforeEach` 清理、`vi.clearAllMocks()` |
| 导入问题 | `Cannot find module` | 修正路径、补齐扩展名 |

## 🧪 输出格式

```json
{
  "fixedCode": "修复后的完整测试文件代码",
  "reason": "中文说明修复理由和思路",
  "confidence": 0.85
}
```

- `fixedCode`：包含全部代码，可直接覆盖原文件。
- `reason`：简洁说明导致失败的根因与修复策略。
- `confidence`：0~1 之间的小数，四舍五入到 2 位小数。

## 🛡️ 校验清单

- [ ] 是否仅修改测试文件？
- [ ] 是否保持原有编码风格？
- [ ] 是否解释导致失败的原因？
- [ ] 是否给出了合理的置信度？
- [ ] 修复后代码是否语法正确？

## 📌 注意事项

- 避免过度重构或引入无关依赖。
- 避免删除关键断言或弱化测试覆盖。
- 如无法确定正确修复方式，说明不确定因素，降低置信度。
- 同一文件多处修改时，务必一次性返回完整文件内容。

---

此模板可根据具体项目规则动态扩展，例如注入 `.cursor/rule/fe-mcp.md` 中的特殊规范。
